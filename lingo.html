<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Hurra Lingo Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

body {
  background-image: url('./og-image.webp');
  background-size: cover;
  background-position: center top;
  background-repeat: no-repeat;
  background-attachment: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 16px;
  overflow: hidden;
}

.chat-wrapper {
  background: #ffffff;
  width: 100%;
  max-width: 480px;
  height: 80vh;
  max-height: 720px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: all 0.4s ease-in-out;
  opacity: 0;
  transform: scale(0.9) translateY(20px);
  pointer-events: none;
  position: relative;
  z-index: 10;
}

.chat-wrapper.active {
  opacity: 1;
  transform: scale(1) translateY(0);
  pointer-events: all;
}

.chat-header {
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
}

.chat-body {
  flex: 1;
  overflow-y: auto;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: #fafafa;
}

.msg {
  max-width: 85%;
  padding: 10px 12px;
  border-radius: 12px;
  line-height: 1.35;
  font-size: 14px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.msg.user {
  align-self: flex-end;
  background: #111;
  color: #fff;
  border-bottom-right-radius: 4px;
}

.msg.bot {
  align-self: flex-start;
  background: #fff;
  color: #111;
  border: 1px solid #eee;
  border-bottom-left-radius: 4px;
}

/* BUTON STÄ°LÄ° */
.msg.bot a.chat-btn {
  display: inline-block;
  margin-top: 8px;
  padding: 8px 14px;
  background: #111;
  color: #fff;
  border-radius: 10px;
  text-decoration: none;
  font-size: 13px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.msg.bot a.chat-btn:hover {
  background: #333;
  transform: translateY(-1px);
}

.chat-footer {
  border-top: 1px solid #eee;
  padding: 10px;
  display: flex;
  gap: 8px;
  background: #fff;
}

.chat-input {
  flex: 1;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 14px;
  outline: none;
}

.chat-send {
  border: none;
  border-radius: 10px;
  padding: 10px 12px;
  cursor: pointer;
  background: #111;
  color: #fff;
  font-weight: 600;
}

.toggle-btn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: #fff;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
</style>
</head>
<body>

<div class="chat-wrapper" id="chatWrapper">
  <div class="chat-header">
    <div>Hurra Lingo Chat</div>
    <div id="chatStatus">HazÄ±r</div>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="msg bot">Merhaba! Size nasÄ±l yardÄ±mcÄ± olabilirim?</div>
  </div>

  <div class="chat-footer">
    <input class="chat-input" id="chatInput" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." />
    <button class="chat-send" id="sendBtn" onclick="sendMessage()">GÃ¶nder</button>
  </div>
</div>

<button class="toggle-btn" onclick="toggleChat()">ðŸ’¬</button>

<script>

// ===== AYARLAR =====
    //const N8N_WEBHOOK_URL = "https://n8n.e12.com.tr/webhook-test/lingo-chatbot";
  const N8N_WEBHOOK_URL = "https://n8n.e12.com.tr/webhook/lingo-chatbot"; // Production webhook URL    
  const API_KEY = "lingo_chatbot_api_key_060320018426"; 
let isLoading = false;

// ===== SESSION ID =====
const sessionId = (() => {
  const k = "hurra_session_id";
  let v = localStorage.getItem(k);
  if (!v) {
    v = "sess_" + Math.random().toString(16).slice(2) + "_" + Date.now();
    localStorage.setItem(k, v);
  }
  return v;
})();

function toggleChat() {
  document.getElementById("chatWrapper").classList.toggle("active");
}

function addMsg(text, who) {
  const chatBody = document.getElementById("chatBody");
  const div = document.createElement("div");
  div.className = "msg " + who;

  if (who === "bot") {
    let safeText = text
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");

    safeText = safeText.replace(
      /(https?:\/\/[^\s]+)/g,
      '<br><a href="$1" target="_blank" class="chat-btn">ðŸŽ“ BaÄŸlantÄ±yÄ± AÃ§</a>'
    );

    div.innerHTML = safeText;
  } else {
    div.textContent = text;
  }

  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}

async function sendMessage() {
  if (isLoading) return;

  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  isLoading = true;

  addMsg(text, "user");
  input.value = "";
  document.getElementById("chatStatus").textContent = "YanÄ±tlanÄ±yor...";

  try {
    const res = await fetch(N8N_WEBHOOK_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + API_KEY
      },
      body: JSON.stringify({
        message: text,
        sessionId: sessionId
      })
    });

    const data = await res.json();
    const item = Array.isArray(data) ? data[0] : data;
    const answer = item?.output ?? "YanÄ±t alÄ±namadÄ±.";

    addMsg(answer, "bot");
    document.getElementById("chatStatus").textContent = "HazÄ±r";

  } catch (e) {
    addMsg("Bir hata oluÅŸtu.", "bot");
    document.getElementById("chatStatus").textContent = "Hata";
  } finally {
    isLoading = false;
  }
}


document.getElementById("chatInput").addEventListener("keydown", (e) => {
  if (e.key === "Enter") sendMessage();
});
</script>

</body>
</html>
